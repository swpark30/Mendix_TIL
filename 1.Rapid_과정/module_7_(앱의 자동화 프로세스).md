# module 7



## 앱의 자동화 프로세스

- 마이크로플로우를 사용하여 사용자 로직을 추가함으로써 앱을 보다 효율적으로 만든다.
- 예)
  - 교육 이벤트의 시작 날짜와 코스 기간을 알면 교육 이벤트의 종료 날짜를 자동으로 입력할 수있다.
  - 자동으로 총 등록 수를 계산한다
  - 특정 페이지에서 항목을 만들 때 특정 필드를 미리 채울 수 있다.
- 배울 방법들
  - 마이크로플로우를 트리거하는 위젯 이벤트 설정
  - 객체 및 값을 변경하기 위한 마이크로플로우 생성
  - 마이크로플로우가 의도한 대로 작동하도록 오류를 해결한다
  - 사용자가 아직 작성하지 않은 정보가 무엇인지 알려준다.



- 종료 날짜 자동으로 채우기

  1. 마이크로플로우를 트리거 한다.
     - 시작날짜 입력 위젯과 코스 선택 위젯, 2개의 위젯이 필요하다
     - 두개의 위젯 이벤트에 종료날짜를 계산하는 마이크로플로우를 트리거 한다.
  2. 이 새로 만든 마이크로플로우로 계산된 종료날짜를 채운다.
     - 이걸 하기 위해서 교육 이벤트를 바꾸고 새로운 EndDate라는 변수값을 설정해줘야한다.
     - 이렇게 하려면 addDays 함수를 사용하는 마이크로플로우 표현식을 작성해야 한다.
     - 이 함수는 날짜(시작날짜)에 일 수(코스기간)을 더해서 새로운 날짜를 계산한다.
  3. 앱을 로컬에서 실행하고 여러 방법으로 데이터를 입력하여 오류가 발생하는지 확인하면서 앱의 기능을 테스트한다.
  4. 오류가 발생했다면 오류를 분석하고 이러한 오류가 다시 발생하지 않도록 마이크로플로우를 수정한다.
  5. 작업을 커밋한다.

  

## 입력 위젯에서 마이크로플로우 트리거 하기

1. 사용자가 교육이벤트나 시작날짜를 바꿨을때 마이크로플로우가 트리거 되는지 확인한다.

   - 입력 위젯은 일반적으로 사용자에게 데이터를 보여주고 편집할 수 있도록 한다.

   - 입력 위젯의 종류

     - check box
     - date picker
     - radio buttons
     - drop down
     - text box

   - 버튼을 클릭할 때 이벤트를 트리거 할 수 있는 것과 같은 방식으로 입력 위젯도 동일한 작업을 수행할 수 있다

   - 입력 위젯의 차이점은 이벤트가 3가지 다른 방법으로 트리거될 수 있다는 것이다

     1. On enter : 사용자가 입력 위젯에 입력했을때
     2. On change : 사용자가 입력 위젯 내용을 변경하고 떠날때
     3. On leave : 사용자가 입력 위젯을 떠날때 (위젯 값 변경 여부와 관계없이)

   - 실습

     1. 시작날짜 입력 위젯
        1. TrainingEvent_NewEdit 페이지를 연다
        2. 시작 날짜 입력 위젯을 더블클릭해서 속성창을 연다
        3. General, Common, Events, Appeareance라는 4가지 탭이 있는데 Events 탭을 연다.
        4. 시작날짜가 바뀔때마다 종료날짜를 계산하고 싶기 때문에 On change 이벤트가 필요하다.
        5. 종료날짜를 계산하는 마이크로플로우가 없기때문에 New를 눌러 새로 만든다.
        6. Prefix_Entity_Operation이라는 명명규칙을 따라 이름을 OCH_TrainingEvent_CalculateEndDate이라고 지어준다
     2. 코스 입력 위젯
        1. 교육코스마다 기간이 다르기때문에 코스 입력 위젯에도 마이크로플로우를 트리거 한다.
        2. TrainingEvent_NewEdit로 돌아가서 코스선택위젯의 On Change에 위의 마이크로플로우를 연결한다.
     3. 마이크로플로우를 연다
     4. Activity를 추가하고 타입을 Change object로 바꾼다
     5. Object에 TrainingEvent entity를 넣고 Refresh in client를 yes로 바꾼다.
     6. 그리고 밑의 New를 누르고 Member를 계산할 EndDate로 설정해준다.
     7. Member를 설정해주고 아래 표현식 칸에 addDays() 함수를 작성한다.
        - addDays()함수의 기본 변수유형은 addDays(Date and time, Integer/Long)이다.
        - 표현식은 $변수이름/속성이름/속성이름/.... 식으로해서 최종 가져올 속성을 찾는다.
        - 변수사이에 쉼표를 사용하여 변수를 구분한다.
     8. 변수를 넣기전에 마이크로플로우에서 retrieve를 Change object 왼쪽에 배치한다.
     9. association으로 TraininEvent_Course를 선택하고 완료한다.
     10. 다시 Change object로 돌아가 표현식을 작성한다.

     

   - 마이크로플로우 표현식

     - 일 수를 계산하려면 표현식을 사용해야하는데 표현식은 로우코드중에 코드 부분에 해당한다.
     - 표현식을 사용하면 함수를 만들수 있고 빌드 검사를하고 값을 바꿀 수 있다.
     - 다음 요소의 유형을 사용할 수 있다.
       - 함수
         - 수정하거나 비교하거나 값에서 정보를 추출할 수 있는 많은 함수들이 있다.
         - 작성법 : functionName(Ingredient 1, Ingredient 2)
       - 변수
         - 단일 객체, 객체 목록, 기본 값이 포함된다.
         - 변수는 항상 $기호와 변수이름으로 시작한다.
         - 마이크로플로우의 모든 데이터는 변수에 저장되고 고유의 이름을 갖는다.
       - 토큰
         - 현재 사용자 토큰을 제외하고 DateTime과 관련되어있다.
         - [ 기호를 치면 목록들이 나온다.
     - 일반적인 표현식
       - Arithmetic
         - `* : + -`
       - Relational
         - `< > <= >= = !=`
       - Special checks
         - empty is New
       - Boolean
         - and or not
       - If expressions
         - if then else

   - 마이크로 플로우 범위

     - 객체 내부의 모든 정보(속성)와 객체가 연결된 객체에 액세스 할 수 있다.

   - Retrieving Data (데이터 검색)

     - 마이크로플로우를 시작할 때 필요한 데이터가 범위에 없는 경우가 있는데 이러한 데이터를 범위로 가져오는 방법은 Retrieve를 사용하는 것이다.
     - 마이크로플로우의 다른 Activity와 같은 역할을 한다.
     - 객체 목록에서 특정 객체를 찾아 마이크로플로우에서 사용할 수 있도록 한다.
     - retrieve를 사용할때는 정보를 얻을 위치를 정해야 한다.
       - 2가지가 있다
         - 메모리에서 받는다
         - 데이터베이스에서 받는다.

   - Association Retrieve (연결된 검색)

     - 메모리에서 받는 retrieve를 말한다.
     - 정보가 메모리에 있으면 Association Retrieve이 Database retrieve보다 빠르다.
     - 사용 이유
       - 가져오려는 정보가 데이터베이스에 아직 없기 때문이다.
     - 메모리에는 있지만 데이터베이스에는 없는 객체를 transient object(임시 객체)라고 한다.
       - 임시객체는 항상 Association Retrieve에 포함되고 포함하고 싶지 않으면 Database retrieve을 사용해야한다.

   - 오류발생

     - 코스기간이나 시작 날짜중 하나를 먼저 고르면 나머지 하나가 없는 상태에서 마이크로플로우가 진행되므로 오류가 발생한다.
     - 해결방안
       - addDays함수가 실행되기 전에 필요한 모든 변수가 보일 수있도록 체크포인트를 빌드해야한다. 그러기 위해서 Decisions을 사용한다

   - Decisions 사용

     - 코딩의 if문과 같다.



## 커밋하기

- Pro 하단에 change탭에 commit 버튼이 있다.



## 총 등록 수 자동 계산

- 교육 이벤트에 교육생이 얼마나 등록을 했는지 알아보고 싶은 상황이다.
  1.  앱에서 정보를 볼 수 있는지 확인한다.
  2. 언제 등록한 수가 계산되어야 하는지 결정한다.
  3. 총 등록수를 계산하는 마이크로플로우를 빌드한다.
  4. 작업을 배포하고 테스트 한다.
  5. 변경사항을 팀서버에 커밋한다. 



## 저장된 속성 VS 계산된 속성





## 객체 이벤트 핸들러

- 4가지 이벤트가 발생할 수 있다.

  - 객체가 생성될때
  - 객체가 커밋될때
  - 객체가 삭제될때
  - 객체가 롤백될때(저장하기전으로)

- 이벤트 실행되기 전과 실행된 후로 마이크로플로우를 트리거 할 수 있다.

- 객체 이벤트 핸들러 추가하기

  - 커밋 후 이벤트 핸들러와 삭제 후 이벤트 핸들러 2가지가 필요하다.

  - 객체 이벤트 핸들러의 접두사들:

    |          | Before | After |
    | -------- | ------ | ----- |
    | Create   | BCR    | ACR   |
    | Commit   | BCO    | ACO   |
    | Rollback | BRO    | ARO   |
    | Delete   | BDE    | ADE   |

  - 도메인 모델의 Registration entity 속성창에서 이벤트핸들러 탭으로 간다

  - New를 눌러 2가지 핸들러를 생성한다.



## 로직 봇으로 실험

- 마이크로플로우에서 로직 봇이 켜져있으면 파란점을 클릭했을때 자동으로 만드는 목록이 나온다.

