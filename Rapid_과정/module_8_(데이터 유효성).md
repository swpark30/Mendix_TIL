# module 8



## 데이터 유효성과 일관성

- 데이터 추가할때 유효성 검사 하는데 3가지 메소드가 있다.
  - 도메인 모델의 Validation Rules (유효성 검사 규칙)
    - 프로젝트에 있는 모든 요소, 페이지나 마이크로플로우가 유효성 검사를 통과해야한다.
    - 여기에 유효성을 적용하면 모든곳에서 적용된다.
  - Microflows
    - 마이크로플로우에 유효성검사를 추가하면 모든 사람이 유효성 검사 규칙에 더 쉽게 접근하고 볼 수 있다. 이 규칙은 기본 도메인 모델에 영향을 주지 않고 쉽게 업데이트 된다.
  - Pages
    - 페이지에 유효성검사를 추가하면 해당 페이지만 적용된다.
    - 필드당 하나의 유효성검사만 할 수 있다.
- 유효성 규칙 추가하기
  - 객체가 데이터베이스에 저장되기 전에 해야한다.
  - 도메인모델의 속성들에 적용된다.
  - 유효성 규칙이 어긋날때 나타나는 에러 메세지를 입력할 수 있다.
  - 도메인모델의 속성들에 적용 할 수있는 규칙의 종류
    - Required 
      - 속성의 내용이 반드시 필요하다. 없으면 안된다.
    - Unique (중복체크)
      - 같은 엔티티에서 다른 모든 객체들과 비교했을때 유니크해야한다.
    - Equals (비밀번호 양식이나 확인)
      - 속성 값은 지정된 값과 같거나 동일한 객체의 다른 속성 값과 같아야한다.
    - Range (범위)
      - 속성 값은 지정된 값 사이 또는 동일한 객체의 다른 속성 값 사이의 범위에 있어야 한다.
    - Regular expression (정규식)
      - 속성은 정규식과 동일해야 한다. 
      - 정규식은 패턴 인식을 사용하여 값을 확인한다.
    - Maximum length (최대 길이)
      - 속성은 지정된 문자 수 이하여야 한다.
  - 입력 위젯일때는 입력 위젯 아래에 에러메세지가 뜨고 입력 위젯이 아닐때는 팝업창으로 에러 메세지가 뜬다.
  - 마이크로플로우의 유효성에서 걸렸을때는 실행이 멈추고 에러메세지가 log창에 뜬다



#### 도메인모델에 유효성 규칙 추가하기

1. 도메인모델을 열고 코스엔티티를 더블클릭하여 속성창을 연다
2. Validation rules 탭을 클릭한다.
3. New를 눌러 새로운 유효성 규칙을 추가한다.
4. 규칙을 추가할 속성과 규칙타입을 정한다.
5. 에러메세지를 작성한다.
6. 완료 버튼을 누른다.



## 정규식 (Regular Expression)

- 검색 패턴을 정하는 일련의 문자이다.
- 예)
  - 이메일 주소 패턴 : something@something.ext
- 이메일 주소 패턴처럼 @나 . 이 제대로 들어가지 않으면 검사에서 걸린다.
- 약자 : Regex 



#### 정규식 추가하기

1. Teacher 엔티티의 속성창을 열고 Validation rules 탭으로 간다.
2. 이메일주소에 대한 새로운 규칙을 만든다.
3. Rule 칸에서 정규식을 선택하면 select 버튼이 나오는데 클릭해준다.
4. 정규식이 없으면 New 버튼을 눌러 새로 만든다.
5. 이름을 Email로 하고 ok를 누른다.
6. 정규식창이 뜨면 Expression에 원하는 정규식 패턴을 작성한다.
7. Documentation에는 다른 개발자에게 이게 어떤 정규식인지 알리기 위한 내용을 적는다.





- Training envents 같은 경우
  - 3개 속성이가 다른 엔티티와 연결된 것이기 때문에 도메인 모델에서 유효성 검사를 할 수 없다.
  - 페이지나 마이크로플로우에서 유효성 검사를 해야한다.
  - 이 경우엔 페이지보다 마이크로플로우가 더 미래지향적이기 때문에 우선시 된다.
  - 마이크로플로우는 여러 번 사용할 수있지만 페이지는 유효성 하려면 매번 새로고침을 해야하기때문이다.
- 마이크로플로우로 트리거 될때 2가지 옵션이 있다.
  - 도메인 모델의 TraningEvent 엔티티에서 before commit 이벤트 핸들러 
  - TrainingEvent_NewEdit 페이지에서 커스텀 저장 버튼



## 유효성검사 마이크로플로우 만들기

1. TrainingEvent_NewEdit 페이지를 연다.

2. 저장버튼을 오른쪽 클릭하고 Edit on click action을 누른다.
3. On click 내용을 Call a microflow로 바꾼다.
4. 마이크로플로우가 없기때문에 새로 만들어준다.
5. TrainingEvent를 커밋하는 activity와 페이지를 닫는 activity를 만들어준다.





- Decision을 써서 마이크로플로우 표현식으로 유효성 체크를 하면 2가지 문제가 있다.
  - 가독성이 좋지 않다. 
  - 유효성 피드백 메세지를 넣을 수 없다.
    - 메세지를 넣으려면 입력위젯 하나당 decision하나를 빌드해야한다.



#### 유효성 피드백 메세지 추가하기

1. decision의 false flow에 activity를 추가한다.
2. action의 타입은 Validation feedback으로 한다.
3. 변수에는 유효성검사하고싶은 객체를 고르고 멤버에는 메세지가 나오게하고싶은 입력위젯을 고른다.
4. Template에는 보여주고싶은 메세지를 적는다.
5. 완료를 누른다 
6. decision 오른쪽에 merge를 만들고 피드백이랑 연결한다.
7. 타입이 Create variable인 activity를 시작점 다음에 넣는다
8. value에 true라고 적는다.
9. 모든 decision과 feedback 사이에 Change variable을 넣는다.
10. Create variable activity 에서 만든 변수를 선택하고 value에 false를 넣는다.
11. 마지막 decision 다음에 decision을 하나 더 만들고 7번 변수를 넣어준다.





## 객체 삭제

- 도메인 모델에서 연결부분을 더블클릭하면 삭제할때의 옵션이 나온다.
- 옵션은 3가지가 있다.
  1. Keep 'Registration' object
     - 교육 이벤트는 지우고 해당 이벤트에 속한 모든 등록은 시스템에 남겨둔다는 의미
     - no predefinition (사전정의 없음)이라고 부르고 기본 설정으로 되어있다.
  2. Delete 'Registration' object as well
     - 교육 이벤트와 해당 이벤트에 속한 모든 등록은 시스템에서 삭제된다는 의미
     - cascading delete (계단식 삭제) 라고 부른다
  3. Delete 'TrainingEvent' object only if it is not associated with 'Registration' object
     - 교육 이벤트에 아직 연결된 등록이 없는 경우에만 삭제할 수 있다는 의미
     - prevention of delete (삭제 방지) 라고 부른다.
     - 이 옵션을 선택하면 삭제할 수 없는 이유의 메세지를 표시하는 옵션도 제공



#### 삭제 버튼 추가하기

1. TrainingEvent_Overview 페이지를 연다 

2. 삭제버튼을 세부버튼 오른쪽에 넣는다.

3. 버튼의 속성창을 연다.

4. 버튼 스타일링을 해주고 삭제 이벤트란에 Close page를 No로 해준다.

5. 완료버튼을 누른다.



#### 삭제 행동 추가 : 삭제 방지

1. 도메인 모델에서 Registration_TrainingEvent 연결 부분을 더블클릭하여 속성창을 연다.
2. 교육이벤트 삭제하는 옵션에서 3번째 옵션을 고른다 
3. 그러면 오류메세지란이 나오는데 오류메세지를 적어준다.
4. 확인버튼을 누른다.
5. 연결부분에 파란 테두리가 생기면 삭제방지가 적용된 것이다.





#### 삭제 행동 추가 : 계단식 삭제

- 하나의 객체가 삭제되면 이 객체에 속한 모든 객체들이 자동으로 삭제된다.
- 연결 부분에 빨간색 테두리가 생기면 계단식 삭제가 적용된 것이다.
- 방법
  1. Trainee_Overview 페이지에 삭제 버튼을 추가한다.
  2. 도메인 모델의 Registration_Trainee 연결 속성창을 연다.
  3. 교육생 객체 삭제란에서 2번째 옵션을 고른다.
  4. 확인을 누른다.

